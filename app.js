function GridCtrl(t,i){this.dotLength=null,this.dotWidth=t,this.dotRadius=this.dotWidth/2,this.padding=i,this.unitSize=t+2*i,this.posData=null,this.negData=null,this.setupTemplate()}function SliderCtrl(t,i){this.rangeMax=t,this.callback=i,this.slideStartBinded=this.slideStart.bind(this),this.slideUpdateBinded=this.slideUpdate.bind(this),this.slideEndBinded=this.slideEnd.bind(this),this.inputHeight=null,this.slideStart=null,this.isTouchSlide=null,this.value=null,this.setupTemplate()}function SummaryCtrl(t){this.retryCallback=t||function(){},this.setupTemplate()}GridCtrl.prototype.setupTemplate=function(){this.el=dom.create("div")},GridCtrl.prototype.setup=function(t,i){this.dotLength=t,this.canvas&&this.el.removeChild(this.canvas),this.rowLength=Math.floor(i/this.unitSize)-2,this.lines=Math.ceil(this.dotLength/this.rowLength),this.canvas=document.createElement("canvas"),this.canvas.classList.add("grid-ctrl"),this.ctx=this.canvas.getContext("2d"),this.canvas.style.width=this.rowLength*this.unitSize+"px",this.canvas.style.height=this.lines*this.unitSize+"px",this.scale=window.devicePixelRatio,this.canvas.width=this.rowLength*this.unitSize*this.scale,this.canvas.height=this.lines*this.unitSize*this.scale,this.ctx.scale(this.scale,this.scale),this.el.appendChild(this.canvas)},GridCtrl.prototype.setDot=function(t,i){var e=this.getPos(t);this.ctx.beginPath(),this.ctx.fillStyle=i?"#11aaff":"#e00043",this.ctx.arc(e.x,e.y,this.dotRadius,0,2*Math.PI),this.ctx.fill()},GridCtrl.prototype.getPos=function(t){return{x:(t%this.rowLength+.5)*this.unitSize,y:(Math.floor(t/this.rowLength)+.5)*this.unitSize}},GridCtrl.prototype.show=function(){this.el.style.display=""},GridCtrl.prototype.hide=function(){this.el.style.display="none"},SliderCtrl.prototype.setupTemplate=function(){this.counterEl=dom.create("p","slider-counter"," ");var t,i,e=[dom.create("div","slider-input-ruler-large")];for(t=0;t<6;t++){for(i=0;i<4;i++)e.push(dom.create("div","slider-input-ruler-thin"));e.push(dom.create("div","slider-input-ruler-large"))}var s=dom.create("div","slider-input-ruler",e);this.inputThumbEl=dom.create("div","slider-input-thumb"),this.inputContainerEl=dom.create("div","slider-input-container",[s,this.inputThumbEl]);var r=dom.create("p","slider-intro","Slide down the circle to trigger");return this.el=dom.create("div","slider-ctrl",[this.counterEl,this.inputContainerEl,r]),this.inputThumbEl.addEventListener("touchstart",this.slideStartBinded),this.inputThumbEl.addEventListener("mousedown",this.slideStartBinded),this.el},SliderCtrl.prototype.reset=function(){this.counterEl.textContent=""},SliderCtrl.prototype.slideStart=function(t){null===this.isTouchSlide&&(t.preventDefault(),t.stopPropagation(),this.isTouchSlide="touchstart"===t.type,this.inputHeight=this.inputContainerEl.getBoundingClientRect().height-this.inputThumbEl.getBoundingClientRect().height,this.slideStart=this.isTouchSlide?t.touches[0].pageY:t.screenY,this.inputThumbEl.classList.remove("reset"),this.inputThumbEl.addEventListener("touchmove",this.slideUpdateBinded),window.addEventListener("mousemove",this.slideUpdateBinded),this.inputThumbEl.addEventListener("touchend",this.slideEndBinded),window.addEventListener("mouseup",this.slideEndBinded))},SliderCtrl.prototype.slideUpdate=function(t){var i=this.isTouchSlide?t.touches[0].pageY:t.screenY,e=Math.min(this.inputHeight,Math.max(0,i-this.slideStart)),s=e/this.inputHeight,r=this.value||0;this.value=Math.floor(this.rangeMax*s),this.counterEl.textContent=this.value,this.inputThumbEl.style.top=e+"px",Math.floor(r/500)!==Math.floor(this.value/500)&&navigator.vibrate&&navigator.vibrate(20)},SliderCtrl.prototype.slideEnd=function(t){this.isTouchSlide=null,this.inputHeight=null,this.slideStart=null,this.inputThumbEl.style.top="0",this.inputThumbEl.classList.add("reset"),this.inputThumbEl.removeEventListener("touchmove",this.slideUpdateBinded),window.removeEventListener("mousemove",this.slideUpdateBinded),this.inputThumbEl.removeEventListener("touchend",this.slideEndBinded),window.removeEventListener("mouseup",this.slideEndBinded),this.value&&this.callback(this.value),this.value=null},SummaryCtrl.prototype.setupTemplate=function(){this.resultEl=dom.create("p","summary-counter-wrap"),this.counterDigitEl=dom.create("span"),this.counterDecimalEl=dom.create("span","small");var t=dom.create("p","summary-counter-wrap-sub",[this.counterDigitEl,this.counterDecimalEl]);this.counterEl=dom.create("div","summary-counter",[this.resultEl,t]),this.resetEl=dom.create("button","pill","RETRY"),this.resetEl.addEventListener("click",this.retryCallback),this.resetEl.addEventListener("touchend",this.retryCallback);var i=dom.create("div","summary-bloc summary-item",[this.resetEl]);this.detailsPosEl=dom.create("div","summary-item bordered pin-pos"),this.detailsNegEl=dom.create("div","summary-item bordered pin-neg"),this.detailsEl=dom.create("div","summary-bloc",[this.detailsPosEl,this.detailsNegEl]);var e=document.getElementById("social");e.classList.add("summary-bloc","summary-item","bordered"),this.el=dom.create("div","summary-ctrl",[this.counterEl,i,dom.create("div","",[this.detailsEl,e])])},SummaryCtrl.prototype.set=function(t,i){var e=(i/t*100).toFixed(2).split(".");this.counterDecimalEl.textContent="."+e[1]+"%",this.counterDigitEl.textContent=e[0],this.detailsPosEl.textContent=i,this.detailsNegEl.textContent=t-i;var s=i-t/2;0<s?(this.el.classList.add("success"),this.resultEl.textContent="Yas!"):s<0?(this.el.classList.add("fail"),this.resultEl.textContent="Nope."):this.resultEl.textContent="Try again",this.el.classList.add("ready")},SummaryCtrl.prototype.show=function(){this.el.style.display=""},SummaryCtrl.prototype.hide=function(){this.el.style.display="none"},SummaryCtrl.prototype.reset=function(){this.el.classList.remove("ready"),this.el.classList.remove("success"),this.el.classList.remove("fail"),this.resultEl.textContent=""};var dom={create:function(t,i,e){var s;if(i=i||{},e=e||null,s=-1===dom.SVG_ELEMENTS.indexOf(t)?document.createElement(t):document.createElementNS(dom.SVG_NAMESPACE,t),i.constructor===String)s.setAttribute("class",i);else for(var r in i)s.setAttribute(r,i[r]);if(e instanceof Array)for(var n=0;n<e.length;n++)s.appendChild(e[n]);else s.textContent=e;return s},icon:function(t){var i=dom.create("use");return i.setAttributeNS(dom.XLINK_NAMESPACE,"href","#icon-"+t),dom.create("svg",{class:"icon"},[i])},clear:function(t){for(var i=t.childNodes.length-1;0<=i;i--)t.childNodes[i].remove()},SVG_NAMESPACE:"http://www.w3.org/2000/svg",XLINK_NAMESPACE:"http://www.w3.org/1999/xlink",SVG_ELEMENTS:["svg","g","circle","line","path","use","rect"]};function Mapper(t,i){this.size=t,this.stack=new Int8Array(t),void 0!==i?(this.ratio=i,this.posPins=Math.round(this.ratio*this.size),this.negPins=this.size-this.posPins,this.fill()):(this.posPins=0,this.negPins=0,this.randomFill())}function pointerglitch(){for(var n=Math.floor(50*(1+Math.random())),h=[],t=0;t<n;t++)h.push(t);return h.sort(function(){return Math.random()-.5}),function(t,i){var e=i%n,s=t-e,r=Math.floor(s/n);return t<e?t:e+r*n+h[s%n]}}function App(){this.dotLength=0,this.windowRect=document.body.getBoundingClientRect(),this.slider=new SliderCtrl(3e3,this.start.bind(this)),document.body.appendChild(this.slider.el),this.grid=new GridCtrl(4,8),document.body.appendChild(this.grid.el),this.summary=new SummaryCtrl(this.retry.bind(this)),this.summary.hide(),document.body.appendChild(this.summary.el),this.scrollBinded=this.scroll.bind(this)}Mapper.prototype.fill=function(){.5<this.ratio?(this.routing(this.negPins),this.invertFill()):this.routing(this.posPins)},Mapper.prototype.invertFill=function(){for(var t=0;t<this.size;t++)this.stack[t]=this.stack[t]?0:1},Mapper.prototype.routing=function(t){for(var i;0<t;)i=Math.floor(this.size*Math.random()),this.stack[i]||(this.stack[i]=1,t--)},Mapper.prototype.randomFill=function(){for(var t,i=0;i<this.size;i++)t=Math.round(Math.random()),(this.stack[i]=t)?this.posPins++:this.negPins++},App.prototype.start=function(t){this.dotLength=t,this.duration=3*t+500,this.starter=Date.now(),this.counter=0,this.allocator=pointerglitch(),this.map=new Mapper(t),this.grid.setup(t,this.windowRect.width),this.grid.show(),this.summary.reset(),this.summary.show(),this.scrollLength=1.2*this.windowRect.height+this.grid.lines*this.grid.unitSize,this.scroll()},App.prototype.scroll=function(){for(var t,i=Math.min(1,(Date.now()-this.starter)/this.duration),e=Math.floor(i*this.map.size);this.counter<e;this.counter++)t=this.allocator(this.counter,this.dotLength),this.grid.setDot(t,this.map.stack[t]);window.scrollTo(0,this.scrollLength*i),1===i?this.scrollEnd():requestAnimationFrame(this.scrollBinded)},App.prototype.scrollEnd=function(){this.slider.reset(),this.summary.set(this.dotLength,this.map.posPins),this.summary.show()},App.prototype.retry=function(){window.scrollTo(0,0),this.summary.reset(),this.summary.hide(),this.grid.hide()};